<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <title>CON-A</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      
      body {
        font-family: "Segoe UI", Arial, sans-serif;
        background-color: #d4d4d4;
        margin: 0;
        padding: 0;
        overflow: hidden;
      }

      /* 엑셀 스타일 툴바 */
      .excel-toolbar {
        background: linear-gradient(to bottom, #f2f2f2, #e6e6e6);
        border-bottom: 1px solid #b3b3b3;
        padding: 4px 8px;
        display: flex;
        align-items: center;
        gap: 8px;
        height: 40px;
        flex-shrink: 0;
      }

      /* 시트 탭 영역 (상단) */
      .sheet-tabs-container {
        background-color: #d4d4d4;
        border-bottom: 1px solid #b3b3b3;
        display: flex;
        align-items: flex-end;
        padding: 0 2px;
        height: 31px;
        overflow-x: auto;
        flex-shrink: 0;
      }

      .toolbar-group {
        display: flex;
        align-items: center;
        gap: 4px;
        padding: 0 8px;
        border-right: 1px solid #b3b3b3;
      }

      .toolbar-group:last-child {
        border-right: none;
      }

      .toolbar-input {
        width: 60px;
        padding: 2px 4px;
        border: 1px solid #8c8c8c;
        font-size: 12px;
      }

      .toolbar-btn {
        padding: 4px 12px;
        border: 1px solid #8c8c8c;
        background: linear-gradient(to bottom, #ffffff, #f0f0f0);
        cursor: pointer;
        font-size: 12px;
        border-radius: 2px;
      }

      .toolbar-btn:hover {
        background: linear-gradient(to bottom, #f0f0f0, #e0e0e0);
      }

      .toolbar-btn-primary {
        background: linear-gradient(to bottom, #0078d4, #005a9e);
        color: white;
        border-color: #005a9e;
      }

      .toolbar-btn-primary:hover {
        background: linear-gradient(to bottom, #005a9e, #004578);
      }

      /* 엑셀 스타일 그리드 */
      .excel-container {
        display: flex;
        flex-direction: column;
        height: 100vh;
        background-color: #ffffff;
      }

      .excel-grid-wrapper {
        flex: 1;
        overflow: auto;
        position: relative;
        background-color: #ffffff;
      }

      .excel-grid {
        border-collapse: collapse;
        font-size: 11px;
        font-family: "Segoe UI", Arial, sans-serif;
        min-width: 100%;
      }

      /* 행 번호 컬럼 */
      .row-header {
        background-color: #f2f2f2;
        border: 1px solid #d4d4d4;
        width: 40px;
        min-width: 40px;
        text-align: center;
        font-weight: normal;
        color: #333;
        position: sticky;
        left: 0;
        z-index: 10;
      }

      /* 열 헤더 */
      .col-header {
        background-color: #f2f2f2;
        border: 1px solid #d4d4d4;
        width: 64px;
        min-width: 64px;
        text-align: center;
        font-weight: normal;
        color: #333;
        position: sticky;
        top: 0;
        z-index: 10;
      }

      /* 행 번호와 열 헤더 교차점 */
      .corner-header {
        background-color: #f2f2f2;
        border: 1px solid #d4d4d4;
        position: sticky;
        top: 0;
        left: 0;
        z-index: 20;
      }

      /* 셀 */
      .excel-cell {
        border: 1px solid #d4d4d4;
        padding: 2px 4px;
        min-width: 64px;
        background-color: #ffffff;
        text-align: left;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .excel-cell:hover {
        background-color: #f0f7ff;
      }


      .sheet-tab {
        background: linear-gradient(to bottom, #f2f2f2, #e6e6e6);
        border: 1px solid #b3b3b3;
        border-bottom: 1px solid #b3b3b3;
        border-radius: 2px 2px 0 0;
        padding: 4px 12px;
        margin: 0 1px 0 1px;
        cursor: pointer;
        font-size: 11px;
        color: #333;
        white-space: nowrap;
        min-width: 60px;
        text-align: center;
        position: relative;
      }

      .sheet-tab.active {
        background: linear-gradient(to bottom, #ffffff, #f2f2f2);
        border-bottom: 1px solid #ffffff;
        z-index: 1;
        height: 32px;
        box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
      }

      .sheet-tab:hover {
        background: linear-gradient(to bottom, #ffffff, #f0f0f0);
      }

      /* 메시지 */
      .message {
        position: absolute;
        top: 80px;
        left: 50%;
        transform: translateX(-50%);
        padding: 8px 16px;
        border-radius: 4px;
        font-size: 12px;
        z-index: 1000;
        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      }

      .message.success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .message.error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      /* 빈 상태 */
      .empty-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        color: #666;
        font-size: 14px;
      }

      .empty-state p {
        margin: 8px 0;
      }
    </style>
  </head>

  <body>
    <div class="excel-container">
      <!-- 엑셀 스타일 툴바 -->
      <div class="excel-toolbar">
        <div class="toolbar-group">
          <form method="post" action="/" style="display: flex; align-items: center; gap: 4px;">
            <label style="font-size: 12px;">번호:</label>
            <input
              type="number"
              name="number_input"
              id="number_input"
              min="1"
              max="2"
              class="toolbar-input"
              placeholder="1 또는 2"
              required
            />
            <button type="submit" class="toolbar-btn toolbar-btn-primary">추가</button>
          </form>
        </div>
        <div class="toolbar-group">
          <form method="post" action="/clear" style="display: inline;">
            <button type="submit" class="toolbar-btn" onclick="return confirm('모든 데이터를 초기화하시겠습니까?')">초기화</button>
          </form>
          <a href="/download" class="toolbar-btn toolbar-btn-primary" style="text-decoration: none; display: inline-block;" {% if not sheet_data %}onclick="return false; style.opacity='0.5';"{% endif %}>다운로드</a>
        </div>
      </div>

      <!-- 시트 탭 (상단) -->
      <div class="sheet-tabs-container">
        <div class="sheet-tab active" onclick="showSheet('대가')">대가</div>
        <div class="sheet-tab" onclick="showSheet('집계')">집계</div>
      </div>

      <!-- 메시지 표시 -->
      {% if message %}
      <div class="message success">{{ message }}</div>
      {% endif %}
      {% if error %}
      <div class="message error">{{ error }}</div>
      {% endif %}

      <!-- 엑셀 그리드 영역 -->
      <div class="excel-grid-wrapper">
        {# 대가 시트 #}
        <div class="sheet-content" id="sheet-대가" style="display: block;">
          {% if sheet_data and '대가' in sheet_data and sheet_data['대가'].rows %}
          <table class="excel-grid">
            <thead>
              <tr>
                <th class="corner-header"></th>
                {% for header in sheet_data['대가'].headers %}
                <th class="col-header">{{ header }}</th>
                {% endfor %}
              </tr>
            </thead>
            <tbody>
              {% for row in sheet_data['대가'].rows %}
              <tr>
                <td class="row-header">{{ loop.index }}</td>
                {% for cell in row %}
                <td class="excel-cell">{{ cell }}</td>
                {% endfor %}
                {# 빈 셀 채우기 #}
                {% if sheet_data['대가'].headers|length > row|length %}
                  {% for i in range(sheet_data['대가'].headers|length - row|length) %}
                  <td class="excel-cell"></td>
                  {% endfor %}
                {% endif %}
              </tr>
              {% endfor %}
            </tbody>
          </table>
          {% else %}
          <div class="empty-state">
            <p>데이터가 없습니다.</p>
            <p>번호를 입력하여 데이터를 추가하세요.</p>
          </div>
          {% endif %}
        </div>

        {# 집계 시트 #}
        <div class="sheet-content" id="sheet-집계" style="display: none;">
          {% if sheet_data and '집계' in sheet_data and sheet_data['집계'].rows %}
          <table class="excel-grid">
            <thead>
              <tr>
                <th class="corner-header"></th>
                {% for header in sheet_data['집계'].headers %}
                <th class="col-header">{{ header }}</th>
                {% endfor %}
              </tr>
            </thead>
            <tbody>
              {% for row in sheet_data['집계'].rows %}
              <tr>
                <td class="row-header">{{ loop.index }}</td>
                {% for cell in row %}
                <td class="excel-cell">{{ cell }}</td>
                {% endfor %}
                {# 빈 셀 채우기 #}
                {% if sheet_data['집계'].headers|length > row|length %}
                  {% for i in range(sheet_data['집계'].headers|length - row|length) %}
                  <td class="excel-cell"></td>
                  {% endfor %}
                {% endif %}
              </tr>
              {% endfor %}
            </tbody>
          </table>
          {% else %}
          <div class="empty-state">
            <p>데이터가 없습니다.</p>
            <p>번호를 입력하여 데이터를 추가하세요.</p>
          </div>
          {% endif %}
        </div>
      </div>

    </div>

    <script>
      // 시트 탭 전환
      function showSheet(sheetName) {
        // 모든 시트 콘텐츠 숨기기
        document.querySelectorAll('.sheet-content').forEach(content => {
          content.style.display = 'none';
        });
        
        // 모든 탭 비활성화
        document.querySelectorAll('.sheet-tab').forEach(tab => {
          tab.classList.remove('active');
        });
        
        // 선택한 시트 표시
        const sheetContent = document.getElementById('sheet-' + sheetName);
        if (sheetContent) {
          sheetContent.style.display = 'block';
        }
        
        // 선택한 탭 활성화
        const tabs = document.querySelectorAll('.sheet-tab');
        tabs.forEach(tab => {
          if (tab.textContent.trim() === sheetName) {
            tab.classList.add('active');
          }
        });
      }

      // 번호 입력 필드 제한
      document.getElementById('number_input')?.addEventListener('input', function(e) {
        const value = parseInt(e.target.value);
        if (value < 1) {
          e.target.value = 1;
        } else if (value > 2) {
          e.target.value = 2;
        }
      });

      // 메시지 자동 숨기기
      setTimeout(function() {
        const messages = document.querySelectorAll('.message');
        messages.forEach(msg => {
          msg.style.opacity = '0';
          setTimeout(() => msg.remove(), 300);
        });
      }, 3000);
    </script>
  </body>
</html>
